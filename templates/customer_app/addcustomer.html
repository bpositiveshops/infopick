{% extends 'base.html' %}

{% block title %} Add Customer{% endblock %}

{% block content %}
<h4>Add Customer Details</h4>
<!-- Display customer details here -->
<!-- Add this line in the <head> section of your HTML document -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Profile details form or information -->
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-left">Customer Details</h2>
                </div>
                <div class="card-body">
                    <form id="custForm" method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="custname">Customer Name:</label>
                            <input type="text" class="form-control" id="custname" name="custname" required>
                        </div>
                        <div class="form-group">
                            <label for="custemail">Customer Email:</label>
                            <input type="text" class="form-control" id="custemail" name="custemail" required>
                        </div>
                        <div class="form-group">
                            <label for="custphone">Customer Phone:</label>
                            <input type="text" class="form-control" id="custphone" name="custphone" required>
                        </div>
                        <div class="text-right">
                            <button type="submit" id="submitBtn" class="btn btn-primary">Submit</button>
                        </div>
                    </form>               
                </div>
            </div>
            <!-- Add this modal markup to your HTML template -->
            <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="successModalLabel">Success</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Profile created successfully.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('#custForm').submit(function(event) {
            event.preventDefault(); // Prevent the default form submission behavior
            
            var formData = $("#custForm").serialize();
            var csrftoken = $("[name=csrfmiddlewaretoken]").val();
            
            $.ajax({
                url: '{% url "customer_create" client_id=client_id %}',
                type: 'POST',
                headers: { "X-CSRFToken": csrftoken },
                dataType: 'json',
                data: formData,
                success: function(data) {
                    // Show a modal window with the success message
                    $('#successModal').modal('show');
                    // Reload the page after a brief delay
                    setTimeout(function() {
                        window.location.reload();
                        }, 2000); // 2000 milliseconds (1 second) delay
                    },
                error: function(xhr, status, error) {
                    // Handle error response
                        console.error(xhr.responseText);
                        alert('Failed to submit data. Please try again later.');
                }
            });
        });
    });
</script>
{% endblock %}
