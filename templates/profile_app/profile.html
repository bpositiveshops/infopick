{% extends 'base.html' %}

{% block title %}Profile{% endblock %}

{% block content %}

<!-- Add this line in the <head> section of your HTML document -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Profile details form or information -->
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-left">Profile Details</h5>
                </div>
                <div class="card-body">
                    <form id="clientForm" method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="clientName">Client Name:</label>
                            <input type="text" class="form-control" id="clientName" name="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="location">Location:</label>
                            <input type="text" class="form-control" id="location" name="location" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone:</label>
                            <input type="text" class="form-control" id="phone" name="phone" required>
                        </div>
                        <div class="text-right">
                            <button type="submit" id="submitBtn" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                    <div>
                        {% if client_qrcode %}
                           QR Code <img src="data:image/png;base64,{{ client_qrcode.dataqrcode }}" width="200px" height="200px" alt="QR Code">
                        {% else %}
                            <p>No QR code available.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- Add this modal markup to your HTML template -->
            <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="successModalLabel">Success</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Profile created successfully.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
   $(document).ready(function() {
        $('#clientForm').submit(function(event) {
            event.preventDefault(); // Prevent the default form submission behavior
            
            var formData = $("#clientForm").serialize();
            var csrftoken = $("[name=csrfmiddlewaretoken]").val();
            
            $.ajax({
                url: '{% url "profile_create" %}',
                type: 'POST',
                headers: { "X-CSRFToken": csrftoken },
                dataType: 'json',
                data: formData,
                success: function(data) {
                    // Show a modal window with the success message
                    $('#successModal').modal('show');
                    // Reload the page after a brief delay
                    setTimeout(function() {
                        window.location.reload();
                        }, 2000); // 2000 milliseconds (1 second) delay
                    },
                error: function(xhr, status, error) {
                    // Handle error response
                     console.error(xhr.responseText);
                     alert('Failed to submit data. Please try again later.');
                }
            });
        });
    });
</script>

{% endblock %}
